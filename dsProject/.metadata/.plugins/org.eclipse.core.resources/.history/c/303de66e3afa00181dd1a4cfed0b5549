package ie.gmit.ds.rmi;

import java.rmi.RemoteException;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Statement;

import ie.gmit.ds.model.Booking;
import ie.gmit.ds.model.Car;
import ie.gmit.ds.model.Customer;

public class BookigServiceImpl implements BookingService {
	
	//Database connection
		private Connection connection; 

		public BookigServiceImpl() {
			connect();
		}
		
		private void connect() {
			try {
				Class.forName("com.mysql.jdbc.Driver");
				connection = DriverManager.getConnection("jdbc:mysql://localhost:3306/geography", "root", "");
			} catch (Exception e) {
				e.printStackTrace();
			}
		}
		

	@Override
	public void createBooking(Booking booking) throws RemoteException {
		// TODO Auto-generated method stub
		
		final PreparedStatement stmt = connection.prepareStatement("INSERT INTO Booking VALUES (?,?,?)");
		stmt.setString(1, car.getId());
		stmt.setString(2, car.);
		stmt.setString(3, country.getCountryDetails());
		stmt.executeUpdate();
	
		return "list_countries"; // navigate to countries page on success

	}

	@Override
	public void createCustomer(Customer customer) throws RemoteException {
		final PreparedStatement stmt = connection.prepareStatement("INSERT INTO Customer VALUES (?,?)");
		stmt.setString(1, customer.getFirstname());
		stmt.setString(2, customer.getLastname());
		stmt.executeUpdate();
		
		final Statement myStmt = connection.createStatement();
		final ResultSet rs = myStmt .executeQuery("SELECT * FROM Customer WHERE id=?");
		final List<Region> regions = new ArrayList<>();
	
		while (rs.next()) {
			final Region region = new Region();
			region.setCountryCode(rs.getString("co_code"));
			region.setRegionCode(rs.getString("reg_code"));
			region.setRegionName(rs.getString("reg_name"));
			region.setRegionDesc(rs.getString("reg_desc"));
			regions.add(region);
		}
		return regions;
	
		return "list_countries"; // navigate to countries page on succes
		
	}

}
